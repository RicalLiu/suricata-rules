#CVE-2020-17530
#request update needed, untested
alert http $EXTERNAL_NET any <> $HOME_NET any 
(
    msg:"CVE-2020-17530 On struts2 Attempt";
    priority:1;
    content:"POST";http_method;
    flow:to_serve;
    content:"%{(#instancemanager=#application[|22|org.apache.tomcat.InstanceManager|22|]).(#stack=#attr[|22|com.opensymphony.xwork2.util.ValueStack.ValueStack|22|]).(#bean=#instancemanager.newInstance(|22|org.apache.commons.collections.BeanMap|22|)).(#bean.setBean(#stack)).(#context=#bean.get(|22|context|22|)).(#bean.setBean(#context)).(#macc=#bean.get(|22|memberAccess|22|)).(#bean.setBean(#macc)).(#emptyset=#instancemanager.newInstance(|22|java.util.HashSet|22|)).(#bean.put(|22|excludedClasses|22|,#emptyset)).(#bean.put(|22|excludedPackageNames|22|,#emptyset)).(#arglist=#instancemanager.newInstance(|22|java.util.ArrayList|22|))";http.client_body;
    content:"(#execute=#instancemanager.newInstance(|22|freemarker.template.utility.Execute|22|)).(#execute.exec(#arglist))}";within:50;fast_pattern;
    content:"200";http_stat_code;
    sid:3017039;
    metadate:created_at 2021_1_4,by RicalLiu;
    reference: cve, 2020-17530;
    rev:1;
)

